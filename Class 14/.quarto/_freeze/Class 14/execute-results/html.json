{
  "hash": "dc777d9377796e4ec312e54391b33c0c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Class 14: RNASeq mini project\"\nauthor: \"Michael Romero (PID: A18135877)\"\nformat: html\ntoc: true\n---\n\n## Background\n\nHere we work through a complete RNASeq analysis project. The input data comes from a knock-down experiment of a HOX gene\n\n## Data Import\n\nReading the `counts` and `metadata` CSV files\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncounts <- read.csv(\"GSE37704_featurecounts.csv\", row.names = 1)\n\nmetadata <- read.csv(\"GSE37704_metadata.csv\")\n```\n:::\n\n\n\nCheck on data structure\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(counts)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                length SRR493366 SRR493367 SRR493368 SRR493369 SRR493370\nENSG00000186092    918         0         0         0         0         0\nENSG00000279928    718         0         0         0         0         0\nENSG00000279457   1982        23        28        29        29        28\nENSG00000278566    939         0         0         0         0         0\nENSG00000273547    939         0         0         0         0         0\nENSG00000187634   3214       124       123       205       207       212\n                SRR493371\nENSG00000186092         0\nENSG00000279928         0\nENSG00000279457        46\nENSG00000278566         0\nENSG00000273547         0\nENSG00000187634       258\n```\n\n\n:::\n:::\n\n\nSome book-keeping is required as there looks to be a mismatch between metadata rows and counts column.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nncol(counts)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 7\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnrow(metadata)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 6\n```\n\n\n:::\n:::\n\n\n\nLooks like we need to get rid of the first \"length\" column of our `counts` object.\n>Q. Complete the code below to remove the troublesome first column from countData\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncleancounts <- counts[,-1]\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncolnames(cleancounts)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"SRR493366\" \"SRR493367\" \"SRR493368\" \"SRR493369\" \"SRR493370\" \"SRR493371\"\n```\n\n\n:::\n:::\n\n\n \n\n::: {.cell}\n\n```{.r .cell-code}\nmetadata$id\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"SRR493366\" \"SRR493367\" \"SRR493368\" \"SRR493369\" \"SRR493370\" \"SRR493371\"\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nall( colnames(cleancounts) == metadata$id)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] TRUE\n```\n\n\n:::\n:::\n\n\n### Remove zero count genes\n\nThere are lots of genes with zero counts. We can remove these from further analysis. \n\n::: {.cell}\n\n```{.r .cell-code}\nhead(cleancounts)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                SRR493366 SRR493367 SRR493368 SRR493369 SRR493370 SRR493371\nENSG00000186092         0         0         0         0         0         0\nENSG00000279928         0         0         0         0         0         0\nENSG00000279457        23        28        29        29        28        46\nENSG00000278566         0         0         0         0         0         0\nENSG00000273547         0         0         0         0         0         0\nENSG00000187634       124       123       205       207       212       258\n```\n\n\n:::\n:::\n\n\n>Q. Complete the code below to filter countData to exclude genes (i.e. rows) where we have 0 read count across all samples (i.e. columns).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nto.keep.inds <- rowSums(cleancounts) > 0\nnonzero_counts <- cleancounts[to.keep.inds,]\n```\n:::\n\n\n\n## DESeq analysis\n\nLoad the package\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(DESeq2)\n```\n:::\n\n\nSetup DESeq\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndds <- DESeqDataSetFromMatrix(countData = nonzero_counts ,\n                              colData = metadata,\n                              design =  ~condition )\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in DESeqDataSet(se, design = design, ignoreRank): some variables in\ndesign formula are characters, converting to factors\n```\n\n\n:::\n:::\n\n\nrun DESeq\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndds <- DESeq(dds)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nestimating size factors\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nestimating dispersions\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\ngene-wise dispersion estimates\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nmean-dispersion relationship\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nfinal dispersion estimates\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nfitting model and testing\n```\n\n\n:::\n:::\n\n\nget results\n\n\n::: {.cell}\n\n```{.r .cell-code}\nres <- results(dds)\n```\n:::\n\n\n>Q. Call the summary() function on your results to get a sense of how many genes are up or down-regulated at the default 0.1 p-value cutoff.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(res)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nout of 15975 with nonzero total read count\nadjusted p-value < 0.1\nLFC > 0 (up)       : 4349, 27%\nLFC < 0 (down)     : 4396, 28%\noutliers [1]       : 0, 0%\nlow counts [2]     : 1237, 7.7%\n(mean count < 0)\n[1] see 'cooksCutoff' argument of ?results\n[2] see 'independentFiltering' argument of ?results\n```\n\n\n:::\n:::\n\n\n\n## Data Visualization\n\nVolcano plot\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\nggplot(res) + \n  aes(log2FoldChange, -log(padj) ) +\n  geom_point()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 1237 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Class-14_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\nAdd threshold lines for fold-change and P-value and color our subset of genes that make these threshold cut-offs in the plot\n>Q. Improve this plot by completing the below code, which adds color and axis labels\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(res) + \n  aes(log2FoldChange, -log(padj), \n      color = abs(log2FoldChange) > 2 & abs(-log(padj)) > 0.05) + \n  geom_point() + \n  scale_color_manual(values = c(\"blue\", \"black\")) + \n  geom_vline(xintercept=c(-2,2), col=\"red\") + \n  geom_hline(yintercept = -log(0.05), c)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: `geom_hline()`: Ignoring `mapping` because `yintercept` was provided.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Removed 1237 rows containing missing values or values outside the scale range\n(`geom_point()`).\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](Class-14_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n## Add Annotation\n\n>Q. Use the mapIDs() function multiple times to add SYMBOL, ENTREZID and GENENAME annotation to our results by completing the code below.\n\nAdd gene symbols and entrez ids\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(AnnotationDbi)\nlibrary(org.Hs.eg.db)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nres$symbol <- mapIds(x=org.Hs.eg.db,\n       keys=row.names(res),\n       keytype = \"ENSEMBL\", \n       column = \"SYMBOL\" )\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n'select()' returned 1:many mapping between keys and columns\n```\n\n\n:::\n\n```{.r .cell-code}\nres$entrez <- mapIds(x=org.Hs.eg.db,\n       keys=row.names(res),\n       keytype = \"ENSEMBL\", \n       column = \"ENTREZID\" )\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n'select()' returned 1:many mapping between keys and columns\n```\n\n\n:::\n:::\n\n  \n## Pathway Analysis\n\n\nRun gage analysis\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gage)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(gageData)\nlibrary(pathview)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n##############################################################################\nPathview is an open source software package distributed under GNU General\nPublic License version 3 (GPLv3). Details of GPLv3 is available at\nhttp://www.gnu.org/licenses/gpl-3.0.html. Particullary, users are required to\nformally cite the original Pathview paper (not just mention it) in publications\nor products. For details, do citation(\"pathview\") within R.\n\nThe pathview downloads and uses KEGG data. Non-academic uses may require a KEGG\nlicense agreement (details at http://www.kegg.jp/kegg/legal.html).\n##############################################################################\n```\n\n\n:::\n:::\n\n\nWe need a named vector of fold-change values as input for gage\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfoldchanges = res$log2FoldChange\nnames(foldchanges) = res$entrez\nhead(foldchanges)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       <NA>      148398       26155      339451       84069       84808 \n 0.17925708  0.42645712 -0.69272046  0.72975561  0.04057653  0.54281049 \n```\n\n\n:::\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(pathview)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(kegg.sets.hs)\ndata(sigmet.idx.hs)\n\nkegg.sets.hs = kegg.sets.hs[sigmet.idx.hs]\n\nhead(kegg.sets.hs, 3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$`hsa00232 Caffeine metabolism`\n[1] \"10\"   \"1544\" \"1548\" \"1549\" \"1553\" \"7498\" \"9\"   \n\n$`hsa00983 Drug metabolism - other enzymes`\n [1] \"10\"     \"1066\"   \"10720\"  \"10941\"  \"151531\" \"1548\"   \"1549\"   \"1551\"  \n [9] \"1553\"   \"1576\"   \"1577\"   \"1806\"   \"1807\"   \"1890\"   \"221223\" \"2990\"  \n[17] \"3251\"   \"3614\"   \"3615\"   \"3704\"   \"51733\"  \"54490\"  \"54575\"  \"54576\" \n[25] \"54577\"  \"54578\"  \"54579\"  \"54600\"  \"54657\"  \"54658\"  \"54659\"  \"54963\" \n[33] \"574537\" \"64816\"  \"7083\"   \"7084\"   \"7172\"   \"7363\"   \"7364\"   \"7365\"  \n[41] \"7366\"   \"7367\"   \"7371\"   \"7372\"   \"7378\"   \"7498\"   \"79799\"  \"83549\" \n[49] \"8824\"   \"8833\"   \"9\"      \"978\"   \n\n$`hsa00230 Purine metabolism`\n  [1] \"100\"    \"10201\"  \"10606\"  \"10621\"  \"10622\"  \"10623\"  \"107\"    \"10714\" \n  [9] \"108\"    \"10846\"  \"109\"    \"111\"    \"11128\"  \"11164\"  \"112\"    \"113\"   \n [17] \"114\"    \"115\"    \"122481\" \"122622\" \"124583\" \"132\"    \"158\"    \"159\"   \n [25] \"1633\"   \"171568\" \"1716\"   \"196883\" \"203\"    \"204\"    \"205\"    \"221823\"\n [33] \"2272\"   \"22978\"  \"23649\"  \"246721\" \"25885\"  \"2618\"   \"26289\"  \"270\"   \n [41] \"271\"    \"27115\"  \"272\"    \"2766\"   \"2977\"   \"2982\"   \"2983\"   \"2984\"  \n [49] \"2986\"   \"2987\"   \"29922\"  \"3000\"   \"30833\"  \"30834\"  \"318\"    \"3251\"  \n [57] \"353\"    \"3614\"   \"3615\"   \"3704\"   \"377841\" \"471\"    \"4830\"   \"4831\"  \n [65] \"4832\"   \"4833\"   \"4860\"   \"4881\"   \"4882\"   \"4907\"   \"50484\"  \"50940\" \n [73] \"51082\"  \"51251\"  \"51292\"  \"5136\"   \"5137\"   \"5138\"   \"5139\"   \"5140\"  \n [81] \"5141\"   \"5142\"   \"5143\"   \"5144\"   \"5145\"   \"5146\"   \"5147\"   \"5148\"  \n [89] \"5149\"   \"5150\"   \"5151\"   \"5152\"   \"5153\"   \"5158\"   \"5167\"   \"5169\"  \n [97] \"51728\"  \"5198\"   \"5236\"   \"5313\"   \"5315\"   \"53343\"  \"54107\"  \"5422\"  \n[105] \"5424\"   \"5425\"   \"5426\"   \"5427\"   \"5430\"   \"5431\"   \"5432\"   \"5433\"  \n[113] \"5434\"   \"5435\"   \"5436\"   \"5437\"   \"5438\"   \"5439\"   \"5440\"   \"5441\"  \n[121] \"5471\"   \"548644\" \"55276\"  \"5557\"   \"5558\"   \"55703\"  \"55811\"  \"55821\" \n[129] \"5631\"   \"5634\"   \"56655\"  \"56953\"  \"56985\"  \"57804\"  \"58497\"  \"6240\"  \n[137] \"6241\"   \"64425\"  \"646625\" \"654364\" \"661\"    \"7498\"   \"8382\"   \"84172\" \n[145] \"84265\"  \"84284\"  \"84618\"  \"8622\"   \"8654\"   \"87178\"  \"8833\"   \"9060\"  \n[153] \"9061\"   \"93034\"  \"953\"    \"9533\"   \"954\"    \"955\"    \"956\"    \"957\"   \n[161] \"9583\"   \"9615\"  \n```\n\n\n:::\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfoldchanges = res$log2FoldChange\nnames(foldchanges) = res$entrez\nhead(foldchanges)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       <NA>      148398       26155      339451       84069       84808 \n 0.17925708  0.42645712 -0.69272046  0.72975561  0.04057653  0.54281049 \n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(\"kegg.gs\")\nkeggres = gage(foldchanges, gsets=kegg.sets.hs)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nattributes(keggres)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$names\n[1] \"greater\" \"less\"    \"stats\"  \n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(keggres$less, 5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                                     p.geomean stat.mean        p.val\nhsa04110 Cell cycle               8.995727e-06 -4.378644 8.995727e-06\nhsa03030 DNA replication          9.424076e-05 -3.951803 9.424076e-05\nhsa03013 RNA transport            1.246882e-03 -3.059466 1.246882e-03\nhsa03440 Homologous recombination 3.066756e-03 -2.852899 3.066756e-03\nhsa04114 Oocyte meiosis           3.784520e-03 -2.698128 3.784520e-03\n                                        q.val set.size         exp1\nhsa04110 Cell cycle               0.001448312      121 8.995727e-06\nhsa03030 DNA replication          0.007586381       36 9.424076e-05\nhsa03013 RNA transport            0.066915975      144 1.246882e-03\nhsa03440 Homologous recombination 0.121861535       28 3.066756e-03\nhsa04114 Oocyte meiosis           0.121861535      102 3.784520e-03\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npathview(gene.data=foldchanges, pathway.id=\"hsa03030\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n'select()' returned 1:1 mapping between keys and columns\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nInfo: Working in directory /Users/michaelromero/Desktop/BIMM143/Class 14\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nInfo: Writing image file hsa03030.pathview.png\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npathview(pathway.id = \"hsa04110\", gene.data = foldchanges)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n'select()' returned 1:1 mapping between keys and columns\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nInfo: Working in directory /Users/michaelromero/Desktop/BIMM143/Class 14\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nInfo: Writing image file hsa04110.pathview.png\n```\n\n\n:::\n:::\n\n\n![](hsa04110.pathview.png)\n\n>Q. Can you do the same procedure as above to plot the pathview figures for the top 5 down-reguled pathways?\n\n![](hsa03030.pathview.png)\n\n\n\n### GO terms\n\nSame analysis but using GO genesets rather than KEGG\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(go.sets.hs)\ndata(go.subs.hs)\n\n# Focus on Biological Process subset of GO\ngobpsets = go.sets.hs[go.subs.hs$BP]\n\ngobpres = gage(foldchanges, gsets=gobpsets)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(gobpres$less, 4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                                            p.geomean stat.mean        p.val\nGO:0048285 organelle fission             1.536227e-15 -8.063910 1.536227e-15\nGO:0000280 nuclear division              4.286961e-15 -7.939217 4.286961e-15\nGO:0007067 mitosis                       4.286961e-15 -7.939217 4.286961e-15\nGO:0000087 M phase of mitotic cell cycle 1.169934e-14 -7.797496 1.169934e-14\n                                                q.val set.size         exp1\nGO:0048285 organelle fission             5.841698e-12      376 1.536227e-15\nGO:0000280 nuclear division              5.841698e-12      352 4.286961e-15\nGO:0007067 mitosis                       5.841698e-12      352 4.286961e-15\nGO:0000087 M phase of mitotic cell cycle 1.195672e-11      362 1.169934e-14\n```\n\n\n:::\n:::\n\n\n### Reactome\n\nLots of folks like the reactome web interface. You can also run this as an R function but lts look at the website first. < https://reactome.org/ >\n\nThe website wants a text file with one gene symbol per line of the genes you want to map to pathways.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsig_genes <- res[res$padj <= 0.05 & !is.na(res$padj), ]$symbol\nhead(sig_genes) #res$symbol\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nENSG00000187634 ENSG00000188976 ENSG00000187961 ENSG00000188290 ENSG00000187608 \n       \"SAMD11\"         \"NOC2L\"        \"KLHL17\"          \"HES4\"         \"ISG15\" \nENSG00000188157 \n         \"AGRN\" \n```\n\n\n:::\n:::\n\nand write out to a file\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite.table(sig_genes, file=\"significant_genes.txt\", row.names=FALSE, col.names=FALSE, quote=FALSE)\n```\n:::\n\n\n>Q: What pathway has the most significant “Entities p-value”? Do the most significant pathways listed match your previous KEGG results? What factors could cause differences between the two methods?\n\nThe cell cycle had the most significant \"Entities p-value\" but many were sufficiently significant. They show similar results but this method displays much more entities in total and with a similar type of diagram.\n\n## Save our Results\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite.csv(res, file=\"myresults.csv\")\n```\n:::\n\n\n",
    "supporting": [
      "Class-14_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}